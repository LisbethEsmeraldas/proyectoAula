function R(e,t,r){this.ordinal_Renamed_Field=e,this.bits=t,this.name=r}R.prototype.ordinal=function(){return this.ordinal_Renamed_Field};R.forBits=function(e){if(e<0||e>=H.length)throw"ArgumentException";return H[e]};var H=[new R(1,0,"M"),new R(0,1,"L"),new R(3,2,"H"),new R(2,3,"Q")],J=21522,Y=[[21522,0],[20773,1],[24188,2],[23371,3],[17913,4],[16590,5],[20375,6],[19104,7],[30660,8],[29427,9],[32170,10],[30877,11],[26159,12],[25368,13],[27713,14],[26998,15],[5769,16],[5054,17],[7399,18],[6608,19],[1890,20],[597,21],[3340,22],[2107,23],[13663,24],[12392,25],[16177,26],[14854,27],[9396,28],[8579,29],[11994,30],[11245,31]],B=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4];function k(e){this.errorCorrectionLevel=R.forBits(e>>3&3),this.dataMask=e&7}k.prototype.GetHashCode=function(){return this.errorCorrectionLevel.ordinal()<<3|this.dataMask};k.prototype.Equals=function(e){var t=e;return this.errorCorrectionLevel==t.errorCorrectionLevel&&this.dataMask==t.dataMask};k.numBitsDiffering=function(e,t){return e^=t,B[e&15]+B[F(e,4)&15]+B[F(e,8)&15]+B[F(e,12)&15]+B[F(e,16)&15]+B[F(e,20)&15]+B[F(e,24)&15]+B[F(e,28)&15]};k.decodeFormatInformation=function(e){var t=k.doDecodeFormatInformation(e);return t!=null?t:k.doDecodeFormatInformation(e^J)};k.doDecodeFormatInformation=function(e){for(var t=4294967295,r=0,n=0;n<Y.length;n++){var a=Y[n],s=a[0];if(s==e)return new k(a[1]);var o=this.numBitsDiffering(e,s);o<t&&(r=a[1],t=o)}return t<=3?new k(r):null};function D(e,t){if(t||(t=e),e<1||t<1)throw"Both dimensions must be greater than 0";this.width=e,this.height=t;var r=e>>5;(e&31)!=0&&r++,this.rowSize=r,this.bits=new Array(r*t);for(var n=0;n<this.bits.length;n++)this.bits[n]=0}Object.defineProperty(D.prototype,"Dimension",{get:function(){if(this.width!=this.height)throw"Can't call getDimension() on a non-square matrix";return this.width}});D.prototype.get_Renamed=function(e,t){var r=t*this.rowSize+(e>>5);return(F(this.bits[r],e&31)&1)!=0};D.prototype.set_Renamed=function(e,t){var r=t*this.rowSize+(e>>5);this.bits[r]|=1<<(e&31)};D.prototype.flip=function(e,t){var r=t*this.rowSize+(e>>5);this.bits[r]^=1<<(e&31)};D.prototype.clear=function(){for(var e=this.bits.length,t=0;t<e;t++)this.bits[t]=0};D.prototype.setRegion=function(e,t,r,n){if(t<0||e<0)throw"Left and top must be nonnegative";if(n<1||r<1)throw"Height and width must be at least 1";var a=e+r,s=t+n;if(s>this.height||a>this.width)throw"The region must fit inside the matrix";for(var o=t;o<s;o++)for(var h=o*this.rowSize,w=e;w<a;w++)this.bits[h+(w>>5)]|=1<<(w&31)};function i(e,t){this.count=e,this.dataCodewords=t}function f(e,t,r){this.ecCodewordsPerBlock=e,r?this.ecBlocks=[t,r]:this.ecBlocks=[t]}Object.defineProperty(f.prototype,"TotalECCodewords",{get:function(){return this.ecCodewordsPerBlock*this.NumBlocks}});Object.defineProperty(f.prototype,"NumBlocks",{get:function(){for(var e=0,t=0;t<this.ecBlocks.length;t++)e+=this.ecBlocks[t].length;return e}});f.prototype.getECBlocks=function(){return this.ecBlocks};function d(e,t,r,n,a,s){this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=[r,n,a,s];for(var o=0,h=r.ecCodewordsPerBlock,w=r.getECBlocks(),l=0;l<w.length;l++){var u=w[l];o+=u.count*(u.dataCodewords+h)}this.totalCodewords=o}Object.defineProperty(d.prototype,"DimensionForVersion",{get:function(){return 17+4*this.versionNumber}});d.prototype.buildFunctionPattern=function(){var e=this.DimensionForVersion,t=new D(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);for(var r=this.alignmentPatternCenters.length,n=0;n<r;n++)for(var a=this.alignmentPatternCenters[n]-2,s=0;s<r;s++)n==0&&(s==0||s==r-1)||n==r-1&&s==0||t.setRegion(this.alignmentPatternCenters[s]-2,a,5,5);return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t};d.prototype.getECBlocksForLevel=function(e){return this.ecBlocks[e.ordinal()]};d.VERSION_DECODE_INFO=[31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017];d.VERSIONS=j();d.getVersionForNumber=function(e){if(e<1||e>40)throw"ArgumentException";return d.VERSIONS[e-1]};d.getProvisionalVersionForDimension=function(e){if(e%4!=1)throw"Error getProvisionalVersionForDimension";try{return d.getVersionForNumber(e-17>>2)}catch{throw"Error getVersionForNumber"}};d.decodeVersionInformation=function(e){for(var t=4294967295,r=0,n=0;n<d.VERSION_DECODE_INFO.length;n++){var a=d.VERSION_DECODE_INFO[n];if(a==e)return this.getVersionForNumber(n+7);var s=k.numBitsDiffering(e,a);s<t&&(r=n+7,t=s)}return t<=3?this.getVersionForNumber(r):null};function j(){return[new d(1,[],new f(7,new i(1,19)),new f(10,new i(1,16)),new f(13,new i(1,13)),new f(17,new i(1,9))),new d(2,[6,18],new f(10,new i(1,34)),new f(16,new i(1,28)),new f(22,new i(1,22)),new f(28,new i(1,16))),new d(3,[6,22],new f(15,new i(1,55)),new f(26,new i(1,44)),new f(18,new i(2,17)),new f(22,new i(2,13))),new d(4,[6,26],new f(20,new i(1,80)),new f(18,new i(2,32)),new f(26,new i(2,24)),new f(16,new i(4,9))),new d(5,[6,30],new f(26,new i(1,108)),new f(24,new i(2,43)),new f(18,new i(2,15),new i(2,16)),new f(22,new i(2,11),new i(2,12))),new d(6,[6,34],new f(18,new i(2,68)),new f(16,new i(4,27)),new f(24,new i(4,19)),new f(28,new i(4,15))),new d(7,[6,22,38],new f(20,new i(2,78)),new f(18,new i(4,31)),new f(18,new i(2,14),new i(4,15)),new f(26,new i(4,13),new i(1,14))),new d(8,[6,24,42],new f(24,new i(2,97)),new f(22,new i(2,38),new i(2,39)),new f(22,new i(4,18),new i(2,19)),new f(26,new i(4,14),new i(2,15))),new d(9,[6,26,46],new f(30,new i(2,116)),new f(22,new i(3,36),new i(2,37)),new f(20,new i(4,16),new i(4,17)),new f(24,new i(4,12),new i(4,13))),new d(10,[6,28,50],new f(18,new i(2,68),new i(2,69)),new f(26,new i(4,43),new i(1,44)),new f(24,new i(6,19),new i(2,20)),new f(28,new i(6,15),new i(2,16))),new d(11,[6,30,54],new f(20,new i(4,81)),new f(30,new i(1,50),new i(4,51)),new f(28,new i(4,22),new i(4,23)),new f(24,new i(3,12),new i(8,13))),new d(12,[6,32,58],new f(24,new i(2,92),new i(2,93)),new f(22,new i(6,36),new i(2,37)),new f(26,new i(4,20),new i(6,21)),new f(28,new i(7,14),new i(4,15))),new d(13,[6,34,62],new f(26,new i(4,107)),new f(22,new i(8,37),new i(1,38)),new f(24,new i(8,20),new i(4,21)),new f(22,new i(12,11),new i(4,12))),new d(14,[6,26,46,66],new f(30,new i(3,115),new i(1,116)),new f(24,new i(4,40),new i(5,41)),new f(20,new i(11,16),new i(5,17)),new f(24,new i(11,12),new i(5,13))),new d(15,[6,26,48,70],new f(22,new i(5,87),new i(1,88)),new f(24,new i(5,41),new i(5,42)),new f(30,new i(5,24),new i(7,25)),new f(24,new i(11,12),new i(7,13))),new d(16,[6,26,50,74],new f(24,new i(5,98),new i(1,99)),new f(28,new i(7,45),new i(3,46)),new f(24,new i(15,19),new i(2,20)),new f(30,new i(3,15),new i(13,16))),new d(17,[6,30,54,78],new f(28,new i(1,107),new i(5,108)),new f(28,new i(10,46),new i(1,47)),new f(28,new i(1,22),new i(15,23)),new f(28,new i(2,14),new i(17,15))),new d(18,[6,30,56,82],new f(30,new i(5,120),new i(1,121)),new f(26,new i(9,43),new i(4,44)),new f(28,new i(17,22),new i(1,23)),new f(28,new i(2,14),new i(19,15))),new d(19,[6,30,58,86],new f(28,new i(3,113),new i(4,114)),new f(26,new i(3,44),new i(11,45)),new f(26,new i(17,21),new i(4,22)),new f(26,new i(9,13),new i(16,14))),new d(20,[6,34,62,90],new f(28,new i(3,107),new i(5,108)),new f(26,new i(3,41),new i(13,42)),new f(30,new i(15,24),new i(5,25)),new f(28,new i(15,15),new i(10,16))),new d(21,[6,28,50,72,94],new f(28,new i(4,116),new i(4,117)),new f(26,new i(17,42)),new f(28,new i(17,22),new i(6,23)),new f(30,new i(19,16),new i(6,17))),new d(22,[6,26,50,74,98],new f(28,new i(2,111),new i(7,112)),new f(28,new i(17,46)),new f(30,new i(7,24),new i(16,25)),new f(24,new i(34,13))),new d(23,[6,30,54,74,102],new f(30,new i(4,121),new i(5,122)),new f(28,new i(4,47),new i(14,48)),new f(30,new i(11,24),new i(14,25)),new f(30,new i(16,15),new i(14,16))),new d(24,[6,28,54,80,106],new f(30,new i(6,117),new i(4,118)),new f(28,new i(6,45),new i(14,46)),new f(30,new i(11,24),new i(16,25)),new f(30,new i(30,16),new i(2,17))),new d(25,[6,32,58,84,110],new f(26,new i(8,106),new i(4,107)),new f(28,new i(8,47),new i(13,48)),new f(30,new i(7,24),new i(22,25)),new f(30,new i(22,15),new i(13,16))),new d(26,[6,30,58,86,114],new f(28,new i(10,114),new i(2,115)),new f(28,new i(19,46),new i(4,47)),new f(28,new i(28,22),new i(6,23)),new f(30,new i(33,16),new i(4,17))),new d(27,[6,34,62,90,118],new f(30,new i(8,122),new i(4,123)),new f(28,new i(22,45),new i(3,46)),new f(30,new i(8,23),new i(26,24)),new f(30,new i(12,15),new i(28,16))),new d(28,[6,26,50,74,98,122],new f(30,new i(3,117),new i(10,118)),new f(28,new i(3,45),new i(23,46)),new f(30,new i(4,24),new i(31,25)),new f(30,new i(11,15),new i(31,16))),new d(29,[6,30,54,78,102,126],new f(30,new i(7,116),new i(7,117)),new f(28,new i(21,45),new i(7,46)),new f(30,new i(1,23),new i(37,24)),new f(30,new i(19,15),new i(26,16))),new d(30,[6,26,52,78,104,130],new f(30,new i(5,115),new i(10,116)),new f(28,new i(19,47),new i(10,48)),new f(30,new i(15,24),new i(25,25)),new f(30,new i(23,15),new i(25,16))),new d(31,[6,30,56,82,108,134],new f(30,new i(13,115),new i(3,116)),new f(28,new i(2,46),new i(29,47)),new f(30,new i(42,24),new i(1,25)),new f(30,new i(23,15),new i(28,16))),new d(32,[6,34,60,86,112,138],new f(30,new i(17,115)),new f(28,new i(10,46),new i(23,47)),new f(30,new i(10,24),new i(35,25)),new f(30,new i(19,15),new i(35,16))),new d(33,[6,30,58,86,114,142],new f(30,new i(17,115),new i(1,116)),new f(28,new i(14,46),new i(21,47)),new f(30,new i(29,24),new i(19,25)),new f(30,new i(11,15),new i(46,16))),new d(34,[6,34,62,90,118,146],new f(30,new i(13,115),new i(6,116)),new f(28,new i(14,46),new i(23,47)),new f(30,new i(44,24),new i(7,25)),new f(30,new i(59,16),new i(1,17))),new d(35,[6,30,54,78,102,126,150],new f(30,new i(12,121),new i(7,122)),new f(28,new i(12,47),new i(26,48)),new f(30,new i(39,24),new i(14,25)),new f(30,new i(22,15),new i(41,16))),new d(36,[6,24,50,76,102,128,154],new f(30,new i(6,121),new i(14,122)),new f(28,new i(6,47),new i(34,48)),new f(30,new i(46,24),new i(10,25)),new f(30,new i(2,15),new i(64,16))),new d(37,[6,28,54,80,106,132,158],new f(30,new i(17,122),new i(4,123)),new f(28,new i(29,46),new i(14,47)),new f(30,new i(49,24),new i(10,25)),new f(30,new i(24,15),new i(46,16))),new d(38,[6,32,58,84,110,136,162],new f(30,new i(4,122),new i(18,123)),new f(28,new i(13,46),new i(32,47)),new f(30,new i(48,24),new i(14,25)),new f(30,new i(42,15),new i(32,16))),new d(39,[6,26,54,82,110,138,166],new f(30,new i(20,117),new i(4,118)),new f(28,new i(40,47),new i(7,48)),new f(30,new i(43,24),new i(22,25)),new f(30,new i(10,15),new i(67,16))),new d(40,[6,30,58,86,114,142,170],new f(30,new i(19,118),new i(6,119)),new f(28,new i(18,47),new i(31,48)),new f(30,new i(34,24),new i(34,25)),new f(30,new i(20,15),new i(61,16)))]}function I(e,t,r){this.x=e,this.y=t,this.count=1,this.estimatedModuleSize=r}Object.defineProperty(I.prototype,"X",{get:function(){return Math.floor(this.x)}});Object.defineProperty(I.prototype,"Y",{get:function(){return Math.floor(this.y)}});I.prototype.incrementCount=function(){this.count++};I.prototype.aboutEquals=function(e,t,r){if(Math.abs(t-this.y)<=e&&Math.abs(r-this.x)<=e){var n=Math.abs(e-this.estimatedModuleSize);return n<=1||n/this.estimatedModuleSize<=1}return!1};function V(e,t,r,n,a,s,o){this.image=e,this.possibleCenters=[],this.startX=t,this.startY=r,this.width=n,this.height=a,this.moduleSize=s,this.crossCheckStateCount=[0,0,0],this.resultPointCallback=o}V.prototype.centerFromEnd=function(e,t){return t-e[2]-e[1]/2};V.prototype.foundPatternCross=function(e){for(var t=this.moduleSize,r=t/2,n=0;n<3;n++)if(Math.abs(t-e[n])>=r)return!1;return!0};V.prototype.crossCheckVertical=function(e,t,r,n){var a=this.image,s=a.height,o=this.crossCheckStateCount;o[0]=0,o[1]=0,o[2]=0;for(var h=e;h>=0&&a.data[t+h*a.width]&&o[1]<=r;)o[1]++,h--;if(h<0||o[1]>r)return NaN;for(;h>=0&&!a.data[t+h*a.width]&&o[0]<=r;)o[0]++,h--;if(o[0]>r)return NaN;for(h=e+1;h<s&&a.data[t+h*a.width]&&o[1]<=r;)o[1]++,h++;if(h==s||o[1]>r)return NaN;for(;h<s&&!a.data[t+h*a.width]&&o[2]<=r;)o[2]++,h++;if(o[2]>r)return NaN;var w=o[0]+o[1]+o[2];return 5*Math.abs(w-n)>=2*n?NaN:this.foundPatternCross(o)?this.centerFromEnd(o,h):NaN};V.prototype.handlePossibleCenter=function(e,t,r){var n=e[0]+e[1]+e[2],a=this.centerFromEnd(e,r),s=this.crossCheckVertical(t,Math.floor(a),2*e[1],n);if(!isNaN(s)){for(var o=(e[0]+e[1]+e[2])/3,h=this.possibleCenters.length,w=0;w<h;w++){var l=this.possibleCenters[w];if(l.aboutEquals(o,s,a))return new I(a,s,o)}var u=new I(a,s,o);this.possibleCenters.push(u),this.resultPointCallback!=null&&this.resultPointCallback.foundPossibleResultPoint(u)}return null};V.prototype.find=function(){for(var e=this.image,t=this.startX,r=this.height,n=t+this.width,a=this.startY+(r>>1),s=[0,0,0],o=0;o<r;o++){var h=a+((o&1)==0?o+1>>1:-(o+1>>1));s[0]=0,s[1]=0,s[2]=0;for(var w=t;w<n&&!e.data[w+e.width*h];)w++;for(var l=0;w<n;){if(e.data[w+h*e.width])if(l==1)s[l]++;else if(l==2){if(this.foundPatternCross(s)){var u=this.handlePossibleCenter(s,h,w);if(u!=null)return u}s[0]=s[2],s[1]=1,s[2]=0,l=1}else s[++l]++;else l==1&&l++,s[l]++;w++}if(this.foundPatternCross(s)){var u=this.handlePossibleCenter(s,h,n);if(u!=null)return u}}if(this.possibleCenters.length!=0)return this.possibleCenters[0];throw"Couldn't find enough alignment patterns"};var Z={};Z.checkAndNudgePoints=function(e,t){for(var r=e.width,n=e.height,a=!0,s=0;s<t.length&&a;s+=2){var o=Math.floor(t[s]),h=Math.floor(t[s+1]);if(o<-1||o>r||h<-1||h>n)throw"Error.checkAndNudgePoints ";a=!1,o==-1?(t[s]=0,a=!0):o==r&&(t[s]=r-1,a=!0),h==-1?(t[s+1]=0,a=!0):h==n&&(t[s+1]=n-1,a=!0)}a=!0;for(var s=t.length-2;s>=0&&a;s-=2){var o=Math.floor(t[s]),h=Math.floor(t[s+1]);if(o<-1||o>r||h<-1||h>n)throw"Error.checkAndNudgePoints ";a=!1,o==-1?(t[s]=0,a=!0):o==r&&(t[s]=r-1,a=!0),h==-1?(t[s+1]=0,a=!0):h==n&&(t[s+1]=n-1,a=!0)}};Z.sampleGrid3=function(e,t,r){for(var n=new D(t),a=new Array(t<<1),s=0;s<t;s++){for(var o=a.length,h=s+.5,w=0;w<o;w+=2)a[w]=(w>>1)+.5,a[w+1]=h;r.transformPoints1(a),Z.checkAndNudgePoints(e,a);try{for(var w=0;w<o;w+=2){var l=e.data[Math.floor(a[w])+e.width*Math.floor(a[w+1])];l&&n.set_Renamed(w>>1,s)}}catch{throw"Error.checkAndNudgePoints"}}return n};var W=3,ee=57,T=8,X=2;function te(e){function t(u,v){var c=u.X-v.X,p=u.Y-v.Y;return Math.sqrt(c*c+p*p)}function r(u,v,c){var p=v.x,g=v.y;return(c.x-p)*(u.y-g)-(c.y-g)*(u.x-p)}var n=t(e[0],e[1]),a=t(e[1],e[2]),s=t(e[0],e[2]),o,h,w;if(a>=n&&a>=s?(h=e[0],o=e[1],w=e[2]):s>=a&&s>=n?(h=e[1],o=e[0],w=e[2]):(h=e[2],o=e[0],w=e[1]),r(o,h,w)<0){var l=o;o=w,w=l}e[0]=o,e[1]=h,e[2]=w}function z(e,t,r){this.x=e,this.y=t,this.count=1,this.estimatedModuleSize=r}Object.defineProperty(z.prototype,"X",{get:function(){return this.x}});Object.defineProperty(z.prototype,"Y",{get:function(){return this.y}});z.prototype.incrementCount=function(){this.count++};z.prototype.aboutEquals=function(e,t,r){if(Math.abs(t-this.y)<=e&&Math.abs(r-this.x)<=e){var n=Math.abs(e-this.estimatedModuleSize);return n<=1||n/this.estimatedModuleSize<=1}return!1};function re(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}function A(){this.image=null,this.possibleCenters=[],this.hasSkipped=!1,this.crossCheckStateCount=[0,0,0,0,0],this.resultPointCallback=null}Object.defineProperty(A.prototype,"CrossCheckStateCount",{get:function(){return this.crossCheckStateCount[0]=0,this.crossCheckStateCount[1]=0,this.crossCheckStateCount[2]=0,this.crossCheckStateCount[3]=0,this.crossCheckStateCount[4]=0,this.crossCheckStateCount}});A.prototype.foundPatternCross=function(e){for(var t=0,r=0;r<5;r++){var n=e[r];if(n==0)return!1;t+=n}if(t<7)return!1;var a=Math.floor((t<<T)/7),s=Math.floor(a/2);return Math.abs(a-(e[0]<<T))<s&&Math.abs(a-(e[1]<<T))<s&&Math.abs(3*a-(e[2]<<T))<3*s&&Math.abs(a-(e[3]<<T))<s&&Math.abs(a-(e[4]<<T))<s};A.prototype.centerFromEnd=function(e,t){return t-e[4]-e[3]-e[2]/2};A.prototype.crossCheckVertical=function(e,t,r,n){for(var a=this.image,s=a.height,o=this.CrossCheckStateCount,h=e;h>=0&&a.data[t+h*a.width];)o[2]++,h--;if(h<0)return NaN;for(;h>=0&&!a.data[t+h*a.width]&&o[1]<=r;)o[1]++,h--;if(h<0||o[1]>r)return NaN;for(;h>=0&&a.data[t+h*a.width]&&o[0]<=r;)o[0]++,h--;if(o[0]>r)return NaN;for(h=e+1;h<s&&a.data[t+h*a.width];)o[2]++,h++;if(h==s)return NaN;for(;h<s&&!a.data[t+h*a.width]&&o[3]<r;)o[3]++,h++;if(h==s||o[3]>=r)return NaN;for(;h<s&&a.data[t+h*a.width]&&o[4]<r;)o[4]++,h++;if(o[4]>=r)return NaN;var w=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(w-n)>=2*n?NaN:this.foundPatternCross(o)?this.centerFromEnd(o,h):NaN};A.prototype.crossCheckHorizontal=function(e,t,r,n){for(var a=this.image,s=a.width,o=this.CrossCheckStateCount,h=e;h>=0&&a.data[h+t*a.width];)o[2]++,h--;if(h<0)return NaN;for(;h>=0&&!a.data[h+t*a.width]&&o[1]<=r;)o[1]++,h--;if(h<0||o[1]>r)return NaN;for(;h>=0&&a.data[h+t*a.width]&&o[0]<=r;)o[0]++,h--;if(o[0]>r)return NaN;for(h=e+1;h<s&&a.data[h+t*a.width];)o[2]++,h++;if(h==s)return NaN;for(;h<s&&!a.data[h+t*a.width]&&o[3]<r;)o[3]++,h++;if(h==s||o[3]>=r)return NaN;for(;h<s&&a.data[h+t*a.width]&&o[4]<r;)o[4]++,h++;if(o[4]>=r)return NaN;var w=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(w-n)>=n?NaN:this.foundPatternCross(o)?this.centerFromEnd(o,h):NaN};A.prototype.handlePossibleCenter=function(e,t,r){var n=e[0]+e[1]+e[2]+e[3]+e[4],a=this.centerFromEnd(e,r),s=this.crossCheckVertical(t,Math.floor(a),e[2],n);if(!isNaN(s)&&(a=this.crossCheckHorizontal(Math.floor(a),Math.floor(s),e[2],n),!isNaN(a))){for(var o=n/7,h=!1,w=this.possibleCenters.length,l=0;l<w;l++){var u=this.possibleCenters[l];if(u.aboutEquals(o,s,a)){u.incrementCount(),h=!0;break}}if(!h){var v=new z(a,s,o);this.possibleCenters.push(v),this.resultPointCallback!=null&&this.resultPointCallback.foundPossibleResultPoint(v)}return!0}return!1};A.prototype.selectBestPatterns=function(){var e=this.possibleCenters.length;if(e<3)throw"Couldn't find enough finder patterns:"+e+" patterns found";if(e>3){for(var t=0,r=0,n=0;n<e;n++){var a=this.possibleCenters[n].estimatedModuleSize;t+=a,r+=a*a}var s=t/e;this.possibleCenters.sort(function(l,u){var v=Math.abs(u.estimatedModuleSize-s),c=Math.abs(l.estimatedModuleSize-s);return v<c?-1:v==c?0:1});for(var o=Math.sqrt(r/e-s*s),h=Math.max(.2*s,o),n=this.possibleCenters-1;n>=0;n--){var w=this.possibleCenters[n];Math.abs(w.estimatedModuleSize-s)>h&&this.possibleCenters.splice(n,1)}}return this.possibleCenters.length>3&&this.possibleCenters.sort(function(l,u){return l.count>u.count?-1:l.count<u.count?1:0}),[this.possibleCenters[0],this.possibleCenters[1],this.possibleCenters[2]]};A.prototype.findRowSkip=function(){var e=this.possibleCenters.length;if(e<=1)return 0;for(var t=null,r=0;r<e;r++){var n=this.possibleCenters[r];if(n.count>=X)if(t==null)t=n;else return this.hasSkipped=!0,Math.floor((Math.abs(t.X-n.X)-Math.abs(t.Y-n.Y))/2)}return 0};A.prototype.haveMultiplyConfirmedCenters=function(){for(var e=0,t=0,r=this.possibleCenters.length,n=0;n<r;n++){var a=this.possibleCenters[n];a.count>=X&&(e++,t+=a.estimatedModuleSize)}if(e<3)return!1;for(var s=t/r,o=0,n=0;n<r;n++)a=this.possibleCenters[n],o+=Math.abs(a.estimatedModuleSize-s);return o<=.05*t};A.prototype.findFinderPattern=function(e){var t=!1;this.image=e;var r=e.height,n=e.width,a=Math.floor(3*r/(4*ee));(a<W||t)&&(a=W);for(var s=!1,o=new Array(5),h=a-1;h<r&&!s;h+=a){o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0;for(var w=0,l=0;l<n;l++)if(e.data[l+h*e.width])(w&1)==1&&w++,o[w]++;else if((w&1)==0)if(w==4)if(this.foundPatternCross(o)){var u=this.handlePossibleCenter(o,h,l);if(u)if(a=2,this.hasSkipped)s=this.haveMultiplyConfirmedCenters();else{var v=this.findRowSkip();v>o[2]&&(h+=v-o[2]-a,l=n-1)}else{do l++;while(l<n&&!e.data[l+h*e.width]);l--}w=0,o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0}else o[0]=o[2],o[1]=o[3],o[2]=o[4],o[3]=1,o[4]=0,w=3;else o[++w]++;else o[w]++;if(this.foundPatternCross(o)){var u=this.handlePossibleCenter(o,h,n);u&&(a=o[0],this.hasSkipped&&(s=this.haveMultiplyConfirmedCenters()))}}var c=this.selectBestPatterns();return te(c),new re(c)};function x(e,t,r,n,a,s,o,h,w){this.a11=e,this.a12=n,this.a13=o,this.a21=t,this.a22=a,this.a23=h,this.a31=r,this.a32=s,this.a33=w}x.prototype.transformPoints1=function(e){for(var t=e.length,r=this.a11,n=this.a12,a=this.a13,s=this.a21,o=this.a22,h=this.a23,w=this.a31,l=this.a32,u=this.a33,v=0;v<t;v+=2){var c=e[v],p=e[v+1],g=a*c+h*p+u;e[v]=(r*c+s*p+w)/g,e[v+1]=(n*c+o*p+l)/g}};x.prototype.transformPoints2=function(e,t){for(var r=e.length,n=0;n<r;n++){var a=e[n],s=t[n],o=this.a13*a+this.a23*s+this.a33;e[n]=(this.a11*a+this.a21*s+this.a31)/o,t[n]=(this.a12*a+this.a22*s+this.a32)/o}};x.prototype.buildAdjoint=function(){return new x(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)};x.prototype.times=function(e){return new x(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)};x.quadrilateralToQuadrilateral=function(e,t,r,n,a,s,o,h,w,l,u,v,c,p,g,C){var m=this.quadrilateralToSquare(e,t,r,n,a,s,o,h),M=this.squareToQuadrilateral(w,l,u,v,c,p,g,C);return M.times(m)};x.squareToQuadrilateral=function(e,t,r,n,a,s,o,h){var w=h-s,l=t-n+s-h;if(w==0&&l==0)return new x(r-e,a-r,e,n-t,s-n,t,0,0,1);var u=r-a,v=o-a,c=e-r+a-o,p=n-s,g=u*w-v*p,C=(c*w-v*l)/g,m=(u*l-c*p)/g;return new x(r-e+C*r,o-e+m*o,e,n-t+C*n,h-t+m*h,t,C,m,1)};x.quadrilateralToSquare=function(e,t,r,n,a,s,o,h){return this.squareToQuadrilateral(e,t,r,n,a,s,o,h).buildAdjoint()};function ne(e,t){this.bits=e,this.points=t}function P(e){this.image=e,this.resultPointCallback=null}P.prototype.sizeOfBlackWhiteBlackRun=function(e,t,r,n){var a=Math.abs(n-t)>Math.abs(r-e);if(a){var s=e;e=t,t=s,s=r,r=n,n=s}for(var o=Math.abs(r-e),h=Math.abs(n-t),w=-o>>1,l=t<n?1:-1,u=e<r?1:-1,v=0,c=e,p=t;c!=r;c+=u){var g=a?p:c,C=a?c:p;if(v==1?this.image.data[g+C*this.image.width]&&v++:this.image.data[g+C*this.image.width]||v++,v==3){var m=c-e,M=p-t;return Math.sqrt(m*m+M*M)}if(w+=h,w>0){if(p==n)break;p+=l,w-=o}}var O=r-e,S=n-t;return Math.sqrt(O*O+S*S)};P.prototype.sizeOfBlackWhiteBlackRunBothWays=function(e,t,r,n){var a=this.sizeOfBlackWhiteBlackRun(e,t,r,n),s=1,o=e-(r-e);o<0?(s=e/(e-o),o=0):o>=this.image.width&&(s=(this.image.width-1-e)/(o-e),o=this.image.width-1);var h=Math.floor(t-(n-t)*s);return s=1,h<0?(s=t/(t-h),h=0):h>=this.image.height&&(s=(this.image.height-1-t)/(h-t),h=this.image.height-1),o=Math.floor(e+(o-e)*s),a+=this.sizeOfBlackWhiteBlackRun(e,t,o,h),a-1};P.prototype.calculateModuleSizeOneWay=function(e,t){var r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.X),Math.floor(e.Y),Math.floor(t.X),Math.floor(t.Y)),n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.X),Math.floor(t.Y),Math.floor(e.X),Math.floor(e.Y));return isNaN(r)?n/7:isNaN(n)?r/7:(r+n)/14};P.prototype.calculateModuleSize=function(e,t,r){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,r))/2};P.prototype.distance=function(e,t){var r=e.X-t.X,n=e.Y-t.Y;return Math.sqrt(r*r+n*n)};P.prototype.computeDimension=function(e,t,r,n){var a=Math.round(this.distance(e,t)/n),s=Math.round(this.distance(e,r)/n),o=(a+s>>1)+7;switch(o&3){case 0:o++;break;case 2:o--;break;case 3:throw"Error"}return o};P.prototype.findAlignmentInRegion=function(e,t,r,n){var a=Math.floor(n*e),s=Math.max(0,t-a),o=Math.min(this.image.width-1,t+a);if(o-s<e*3)throw"Error";var h=Math.max(0,r-a),w=Math.min(this.image.height-1,r+a),l=new V(this.image,s,h,o-s,w-h,e,this.resultPointCallback);return l.find()};P.prototype.createTransform=function(e,t,r,n,a){var s=a-3.5,o,h,w,l;n!=null?(o=n.X,h=n.Y,w=l=s-3):(o=t.X-e.X+r.X,h=t.Y-e.Y+r.Y,w=l=s);var u=x.quadrilateralToQuadrilateral(3.5,3.5,s,3.5,w,l,3.5,s,e.X,e.Y,t.X,t.Y,o,h,r.X,r.Y);return u};P.prototype.sampleGrid=function(e,t,r){var n=Z;return n.sampleGrid3(e,r,t)};P.prototype.processFinderPatternInfo=function(e){var t=e.topLeft,r=e.topRight,n=e.bottomLeft,a=this.calculateModuleSize(t,r,n);if(a<1)throw"Error";var s=this.computeDimension(t,r,n,a),o=d.getProvisionalVersionForDimension(s),h=o.DimensionForVersion-7,w=null;if(o.alignmentPatternCenters.length>0)for(var l=r.X-t.X+n.X,u=r.Y-t.Y+n.Y,v=1-3/h,c=Math.floor(t.X+v*(l-t.X)),p=Math.floor(t.Y+v*(u-t.Y)),g=4;g<=16;g<<=1){w=this.findAlignmentInRegion(a,c,p,g);break}var C=this.createTransform(t,r,n,w,s),m=this.sampleGrid(this.image,C,s),M;return w==null?M=[n,t,r]:M=[n,t,r,w],new ne(m,M)};P.prototype.detect=function(){var e=new A().findFinderPattern(this.image);return this.processFinderPatternInfo(e)};function b(e,t){if(t==null||t.length==0)throw"System.ArgumentException";this.field=e;var r=t.length;if(r>1&&t[0]==0){for(var n=1;n<r&&t[n]==0;)n++;if(n==r)this.coefficients=e.Zero.coefficients;else{this.coefficients=new Array(r-n);for(var a=0;a<this.coefficients.length;a++)this.coefficients[a]=0;for(var s=0;s<this.coefficients.length;s++)this.coefficients[s]=t[n+s]}}else this.coefficients=t}Object.defineProperty(b.prototype,"Zero",{get:function(){return this.coefficients[0]==0}});Object.defineProperty(b.prototype,"Degree",{get:function(){return this.coefficients.length-1}});b.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]};b.prototype.evaluateAt=function(e){if(e==0)return this.getCoefficient(0);var t=this.coefficients.length;if(e==1){for(var r=0,n=0;n<t;n++)r=this.field.addOrSubtract(r,this.coefficients[n]);return r}for(var a=this.coefficients[0],n=1;n<t;n++)a=this.field.addOrSubtract(this.field.multiply(e,a),this.coefficients[n]);return a};b.prototype.addOrSubtract=function(e){if(this.field!=e.field)throw"GF256Polys do not have same GF256 field";if(this.Zero)return e;if(e.Zero)return this;var t=this.coefficients,r=e.coefficients;if(t.length>r.length){var n=t;t=r,r=n}for(var a=new Array(r.length),s=r.length-t.length,o=0;o<s;o++)a[o]=r[o];for(var h=s;h<r.length;h++)a[h]=this.field.addOrSubtract(t[h-s],r[h]);return new b(this.field,a)};b.prototype.multiply1=function(e){if(this.field!=e.field)throw"GF256Polys do not have same GF256 field";if(this.Zero||e.Zero)return this.field.Zero;for(var t=this.coefficients,r=t.length,n=e.coefficients,a=n.length,s=new Array(r+a-1),o=0;o<r;o++)for(var h=t[o],w=0;w<a;w++)s[o+w]=this.field.addOrSubtract(s[o+w],this.field.multiply(h,n[w]));return new b(this.field,s)};b.prototype.multiply2=function(e){if(e==0)return this.field.Zero;if(e==1)return this;for(var t=this.coefficients.length,r=new Array(t),n=0;n<t;n++)r[n]=this.field.multiply(this.coefficients[n],e);return new b(this.field,r)};b.prototype.multiplyByMonomial=function(e,t){if(e<0)throw"System.ArgumentException";if(t==0)return this.field.Zero;for(var r=this.coefficients.length,n=new Array(r+e),a=0;a<n.length;a++)n[a]=0;for(var a=0;a<r;a++)n[a]=this.field.multiply(this.coefficients[a],t);return new b(this.field,n)};b.prototype.divide=function(e){if(this.field!=e.field)throw"GF256Polys do not have same GF256 field";if(e.Zero)throw"Divide by 0";for(var t=this.field.Zero,r=this,n=e.getCoefficient(e.Degree),a=this.field.inverse(n);r.Degree>=e.Degree&&!r.Zero;){var s=r.Degree-e.Degree,o=this.field.multiply(r.getCoefficient(r.Degree),a),h=e.multiplyByMonomial(s,o),w=this.field.buildMonomial(s,o);t=t.addOrSubtract(w),r=r.addOrSubtract(h)}return[t,r]};function y(e){this.expTable=new Array(256),this.logTable=new Array(256);for(var t=1,r=0;r<256;r++)this.expTable[r]=t,t<<=1,t>=256&&(t^=e);for(var r=0;r<255;r++)this.logTable[this.expTable[r]]=r;var n=new Array(1);n[0]=0,this.zero=new b(this,new Array(n));var a=new Array(1);a[0]=1,this.one=new b(this,new Array(a))}Object.defineProperty(y.prototype,"Zero",{get:function(){return this.zero}});Object.defineProperty(y.prototype,"One",{get:function(){return this.one}});y.prototype.buildMonomial=function(e,t){if(e<0)throw"System.ArgumentException";if(t==0)return this.zero;for(var r=new Array(e+1),n=0;n<r.length;n++)r[n]=0;return r[0]=t,new b(this,r)};y.prototype.exp=function(e){return this.expTable[e]};y.prototype.log=function(e){if(e==0)throw"System.ArgumentException";return this.logTable[e]};y.prototype.inverse=function(e){if(e==0)throw"System.ArithmeticException";return this.expTable[255-this.logTable[e]]};y.prototype.addOrSubtract=function(e,t){return e^t};y.prototype.multiply=function(e,t){return e==0||t==0?0:e==1?t:t==1?e:this.expTable[(this.logTable[e]+this.logTable[t])%255]};y.QR_CODE_FIELD=new y(285);y.DATA_MATRIX_FIELD=new y(301);function L(e){this.field=e}L.prototype.decode=function(e,t){for(var r=new b(this.field,e),n=new Array(t),a=0;a<n.length;a++)n[a]=0;for(var s=!1,o=!0,a=0;a<t;a++){var h=r.evaluateAt(this.field.exp(a));n[n.length-1-a]=h,h!=0&&(o=!1)}if(!o)for(var w=new b(this.field,n),l=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),w,t),u=l[0],v=l[1],c=this.findErrorLocations(u),p=this.findErrorMagnitudes(v,c,s),a=0;a<c.length;a++){var g=e.length-1-this.field.log(c[a]);if(g<0)throw"ReedSolomonException Bad error location";e[g]=y.prototype.addOrSubtract(e[g],p[a])}};L.prototype.runEuclideanAlgorithm=function(e,t,r){if(e.Degree<t.Degree){var n=e;e=t,t=n}for(var a=e,s=t,o=this.field.One,h=this.field.Zero,w=this.field.Zero,l=this.field.One;s.Degree>=Math.floor(r/2);){var u=a,v=o,c=w;if(a=s,o=h,w=l,a.Zero)throw"r_{i-1} was zero";s=u;for(var p=this.field.Zero,g=a.getCoefficient(a.Degree),C=this.field.inverse(g);s.Degree>=a.Degree&&!s.Zero;){var m=s.Degree-a.Degree,M=this.field.multiply(s.getCoefficient(s.Degree),C);p=p.addOrSubtract(this.field.buildMonomial(m,M)),s=s.addOrSubtract(a.multiplyByMonomial(m,M))}h=p.multiply1(o).addOrSubtract(v),l=p.multiply1(w).addOrSubtract(c)}var O=l.getCoefficient(0);if(O==0)throw"ReedSolomonException sigmaTilde(0) was zero";var S=this.field.inverse(O),K=l.multiply2(S),$=s.multiply2(S);return[K,$]};L.prototype.findErrorLocations=function(e){var t=e.Degree;if(t==1)return new Array(e.getCoefficient(1));for(var r=new Array(t),n=0,a=1;a<256&&n<t;a++)e.evaluateAt(a)==0&&(r[n]=this.field.inverse(a),n++);if(n!=t)throw"Error locator degree does not match number of roots";return r};L.prototype.findErrorMagnitudes=function(e,t,r){for(var n=t.length,a=new Array(n),s=0;s<n;s++){for(var o=this.field.inverse(t[s]),h=1,w=0;w<n;w++)s!=w&&(h=this.field.multiply(h,y.prototype.addOrSubtract(1,this.field.multiply(t[w],o))));a[s]=this.field.multiply(e.evaluateAt(o),this.field.inverse(h)),r&&(a[s]=this.field.multiply(a[s],o))}return a};var Q={};Q.forReference=function(e){if(e<0||e>7)throw"System.ArgumentException";return Q.DATA_MASKS[e]};function ie(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)},this.isMasked=function(e,t){return(e+t&1)==0}}function ae(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)},this.isMasked=function(e,t){return(e&1)==0}}function oe(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)},this.isMasked=function(e,t){return t%3==0}}function se(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)},this.isMasked=function(e,t){return(e+t)%3==0}}function he(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)},this.isMasked=function(e,t){return(F(e,1)+t/3&1)==0}}function fe(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)},this.isMasked=function(e,t){var r=e*t;return(r&1)+r%3==0}}function we(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)},this.isMasked=function(e,t){var r=e*t;return((r&1)+r%3&1)==0}}function le(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)},this.isMasked=function(e,t){return((e+t&1)+e*t%3&1)==0}}Q.DATA_MASKS=[new ie,new ae,new oe,new se,new he,new fe,new we,new le];function q(e){var t=e.Dimension;if(t<21||(t&3)!=1)throw"Error BitMatrixParser";this.bitMatrix=e,this.parsedVersion=null,this.parsedFormatInfo=null}q.prototype.copyBit=function(e,t,r){return this.bitMatrix.get_Renamed(e,t)?r<<1|1:r<<1};q.prototype.readFormatInformation=function(){if(this.parsedFormatInfo!=null)return this.parsedFormatInfo;for(var e=0,t=0;t<6;t++)e=this.copyBit(t,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(var r=5;r>=0;r--)e=this.copyBit(8,r,e);if(this.parsedFormatInfo=k.decodeFormatInformation(e),this.parsedFormatInfo!=null)return this.parsedFormatInfo;var n=this.bitMatrix.Dimension;e=0;for(var a=n-8,t=n-1;t>=a;t--)e=this.copyBit(t,8,e);for(var r=n-7;r<n;r++)e=this.copyBit(8,r,e);if(this.parsedFormatInfo=k.decodeFormatInformation(e),this.parsedFormatInfo!=null)return this.parsedFormatInfo;throw"Error readFormatInformation"};q.prototype.readVersion=function(){if(this.parsedVersion!=null)return this.parsedVersion;var e=this.bitMatrix.Dimension,t=e-17>>2;if(t<=6)return d.getVersionForNumber(t);for(var r=0,n=e-11,a=5;a>=0;a--)for(var s=e-9;s>=n;s--)r=this.copyBit(s,a,r);if(this.parsedVersion=d.decodeVersionInformation(r),this.parsedVersion!=null&&this.parsedVersion.DimensionForVersion==e)return this.parsedVersion;r=0;for(var s=5;s>=0;s--)for(var a=e-9;a>=n;a--)r=this.copyBit(s,a,r);if(this.parsedVersion=d.decodeVersionInformation(r),this.parsedVersion!=null&&this.parsedVersion.DimensionForVersion==e)return this.parsedVersion;throw"Error readVersion"};q.prototype.readCodewords=function(){var e=this.readFormatInformation(),t=this.readVersion(),r=Q.forReference(e.dataMask),n=this.bitMatrix.Dimension;r.unmaskBitMatrix(this.bitMatrix,n);for(var a=t.buildFunctionPattern(),s=!0,o=new Array(t.totalCodewords),h=0,w=0,l=0,u=n-1;u>0;u-=2){u==6&&u--;for(var v=0;v<n;v++)for(var c=s?n-1-v:v,p=0;p<2;p++)a.get_Renamed(u-p,c)||(l++,w<<=1,this.bitMatrix.get_Renamed(u-p,c)&&(w|=1),l==8&&(o[h++]=w,l=0,w=0));s^=!0}if(h!=t.totalCodewords)throw"Error readCodewords";return o};function G(e,t){this.numDataCodewords=e,this.codewords=t}G.getDataBlocks=function(e,t,r){if(e.length!=t.totalCodewords)throw"ArgumentException";for(var n=t.getECBlocksForLevel(r),a=0,s=n.getECBlocks(),o=0;o<s.length;o++)a+=s[o].count;for(var h=new Array(a),w=0,l=0;l<s.length;l++)for(var u=s[l],o=0;o<u.count;o++){var v=u.dataCodewords,c=n.ecCodewordsPerBlock+v;h[w++]=new G(v,new Array(c))}for(var p=h[0].codewords.length,g=h.length-1;g>=0;){var C=h[g].codewords.length;if(C==p)break;g--}g++;for(var m=p-n.ecCodewordsPerBlock,M=0,o=0;o<m;o++)for(var l=0;l<w;l++)h[l].codewords[o]=e[M++];for(var l=g;l<w;l++)h[l].codewords[m]=e[M++];for(var O=h[0].codewords.length,o=m;o<O;o++)for(var l=0;l<w;l++){var S=l<g?o:o+1;h[l].codewords[S]=e[M++]}return h};function E(e,t,r){this.blockPointer=0,this.bitPointer=7,this.dataLength=0,this.blocks=e,this.numErrorCorrectionCode=r,t<=9?this.dataLengthMode=0:t>=10&&t<=26?this.dataLengthMode=1:t>=27&&t<=40&&(this.dataLengthMode=2)}E.prototype.getNextBits=function(e){var t=0;if(e<this.bitPointer+1){for(var r=0,n=0;n<e;n++)r+=1<<n;return r<<=this.bitPointer-e+1,t=(this.blocks[this.blockPointer]&r)>>this.bitPointer-e+1,this.bitPointer-=e,t}else if(e<this.bitPointer+1+8){for(var a=0,n=0;n<this.bitPointer+1;n++)a+=1<<n;return t=(this.blocks[this.blockPointer]&a)<<e-(this.bitPointer+1),this.blockPointer++,t+=this.blocks[this.blockPointer]>>8-(e-(this.bitPointer+1)),this.bitPointer=this.bitPointer-e%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),t}else if(e<this.bitPointer+1+16){for(var a=0,s=0,n=0;n<this.bitPointer+1;n++)a+=1<<n;var o=(this.blocks[this.blockPointer]&a)<<e-(this.bitPointer+1);this.blockPointer++;var h=this.blocks[this.blockPointer]<<e-(this.bitPointer+1+8);this.blockPointer++;for(var n=0;n<e-(this.bitPointer+1+8);n++)s+=1<<n;s<<=8-(e-(this.bitPointer+1+8));var w=(this.blocks[this.blockPointer]&s)>>8-(e-(this.bitPointer+1+8));return t=o+h+w,this.bitPointer=this.bitPointer-(e-8)%8,this.bitPointer<0&&(this.bitPointer=8+this.bitPointer),t}else return 0};E.prototype.NextMode=function(){return this.blockPointer>this.blocks.length-this.numErrorCorrectionCode-2?0:this.getNextBits(4)};E.prototype.getDataLength=function(e){for(var t=0;e>>t!=1;)t++;return this.getNextBits(U.sizeOfDataLengthInfo[this.dataLengthMode][t])};E.prototype.getRomanAndFigureString=function(e){var t=e,r=0,n="",a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];do if(t>1){r=this.getNextBits(11);var s=Math.floor(r/45),o=r%45;n+=a[s],n+=a[o],t-=2}else t==1&&(r=this.getNextBits(6),n+=a[r],t-=1);while(t>0);return n};E.prototype.getFigureString=function(e){var t=e,r=0,n="";do t>=3?(r=this.getNextBits(10),r<100&&(n+="0"),r<10&&(n+="0"),t-=3):t==2?(r=this.getNextBits(7),r<10&&(n+="0"),t-=2):t==1&&(r=this.getNextBits(4),t-=1),n+=r;while(t>0);return n};E.prototype.get8bitByteArray=function(e){var t=e,r=0,n=[];do r=this.getNextBits(8),n.push(r),t--;while(t>0);return n};E.prototype.getKanjiString=function(e){var t=e,r=0,n="";do{r=this.getNextBits(13);var a=r%192,s=r/192,o=(s<<8)+a,h=0;o+33088<=40956?h=o+33088:h=o+49472,n+=String.fromCharCode(h),t--}while(t>0);return n};Object.defineProperty(E.prototype,"DataByte",{get:function(){var e=[],t=1,r=2,n=4,a=8;do{var s=this.NextMode();if(s==0){if(e.length>0)break;throw"Empty data block"}if(s!=t&&s!=r&&s!=n&&s!=a&&s!=7)throw"Invalid mode: "+s+" in (block:"+this.blockPointer+" bit:"+this.bitPointer+")";var o=this.getDataLength(s);if(o<1)throw"Invalid data length: "+o;switch(s){case t:for(var u=this.getFigureString(o),w=new Array(u.length),h=0;h<u.length;h++)w[h]=u.charCodeAt(h);e.push(w);break;case r:for(var u=this.getRomanAndFigureString(o),w=new Array(u.length),h=0;h<u.length;h++)w[h]=u.charCodeAt(h);e.push(w);break;case n:var l=this.get8bitByteArray(o);e.push(l);break;case a:var u=this.getKanjiString(o);e.push(u);break}}while(!0);return e}});var _={};_.rsDecoder=new L(y.QR_CODE_FIELD);_.correctErrors=function(e,t){for(var r=e.length,n=new Array(r),a=0;a<r;a++)n[a]=e[a]&255;var s=e.length-t;try{_.rsDecoder.decode(n,s)}catch(o){throw o}for(var a=0;a<t;a++)e[a]=n[a]};_.decode=function(e){for(var t=new q(e),r=t.readVersion(),n=t.readFormatInformation().errorCorrectionLevel,a=t.readCodewords(),s=G.getDataBlocks(a,r,n),o=0,h=0;h<s.length;h++)o+=s[h].numDataCodewords;for(var w=new Array(o),l=0,u=0;u<s.length;u++){var v=s[u],c=v.codewords,p=v.numDataCodewords;_.correctErrors(c,p);for(var h=0;h<p;h++)w[l++]=c[h]}var g=new E(w,r.versionNumber,n.bits);return g};var U={};U.sizeOfDataLengthInfo=[[10,9,8,8],[12,11,16,10],[14,13,16,12]];function N(){this.imagedata=null,this.width=0,this.height=0,this.qrCodeSymbol=null,this.debug=!1,this.callback=null}N.prototype.decode=function(e,t){var r=function(){try{this.error=void 0,this.result=this.process(this.imagedata)}catch(a){this.error=a,this.result=void 0}return this.callback!=null&&this.callback(this.error,this.result),this.result}.bind(this);if(e!=null&&e.width!=null)this.width=e.width,this.height=e.height,this.imagedata={data:t||e.data},this.imagedata.width=e.width,this.imagedata.height=e.height,r();else{if(typeof Image=="undefined")throw new Error("This source format is not supported in your environment, you need to pass an image buffer with width and height (see https://github.com/edi9999/jsqrcode/blob/master/test/qrcode.js)");var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){var a=document.createElement("canvas"),s=a.getContext("2d"),o=document.getElementById("out-canvas");if(o!=null){var h=o.getContext("2d");h.clearRect(0,0,320,240),h.drawImage(n,0,0,320,240)}a.width=n.width,a.height=n.height,s.drawImage(n,0,0),this.width=n.width,this.height=n.height;try{this.imagedata=s.getImageData(0,0,n.width,n.height)}catch{if(this.result="Cross domain image reading not supported in your browser! Save it to your computer then drag and drop the file!",this.callback!=null)return this.callback(null,this.result)}r()}.bind(this),n.src=e}};N.prototype.decode_utf8=function(e){return decodeURIComponent(escape(e))};N.prototype.process=function(e){for(var t=new Date().getTime(),r=this.grayScaleToBitmap(this.grayscale(e)),n=new P(r),a=n.detect(),s=_.decode(a.bits),o=s.DataByte,h="",w=0;w<o.length;w++)for(var l=0;l<o[w].length;l++)h+=String.fromCharCode(o[w][l]);var u=new Date().getTime(),v=u-t;return this.debug&&console.log("QR Code processing time (ms): "+v),{result:this.decode_utf8(h),points:a.points}};N.prototype.getPixel=function(e,t,r){if(e.width<t||e.height<r)throw"point error";var n=t*4+r*e.width*4;return(e.data[n]*33+e.data[n+1]*34+e.data[n+2]*33)/100};N.prototype.binarize=function(e){for(var t=new Array(this.width*this.height),r=0;r<this.height;r++)for(var n=0;n<this.width;n++){var a=this.getPixel(n,r);t[n+r*this.width]=a<=e}return t};N.prototype.getMiddleBrightnessPerArea=function(e){for(var t=4,r=Math.floor(e.width/t),n=Math.floor(e.height/t),a=new Array(t),s=0;s<t;s++){a[s]=new Array(t);for(var o=0;o<t;o++)a[s][o]=[0,0]}for(var h=0;h<t;h++)for(var w=0;w<t;w++){a[w][h][0]=255;for(var l=0;l<n;l++)for(var u=0;u<r;u++){var v=e.data[r*w+u+(n*h+l)*e.width];v<a[w][h][0]&&(a[w][h][0]=v),v>a[w][h][1]&&(a[w][h][1]=v)}}for(var c=new Array(t),p=0;p<t;p++)c[p]=new Array(t);for(var h=0;h<t;h++)for(var w=0;w<t;w++)c[w][h]=Math.floor((a[w][h][0]+a[w][h][1])/2);return c};N.prototype.grayScaleToBitmap=function(e){for(var t=this.getMiddleBrightnessPerArea(e),r=t.length,n=Math.floor(e.width/r),a=Math.floor(e.height/r),s=0;s<r;s++)for(var o=0;o<r;o++)for(var h=0;h<a;h++)for(var w=0;w<n;w++)e.data[n*o+w+(a*s+h)*e.width]=e.data[n*o+w+(a*s+h)*e.width]<t[o][s];return e};N.prototype.grayscale=function(e){for(var t=new Array(e.width*e.height),r=0;r<e.height;r++)for(var n=0;n<e.width;n++){var a=this.getPixel(e,n,r);t[n+r*e.width]=a}return{height:e.height,width:e.width,data:t}};function F(e,t){return e>=0?e>>t:(e>>t)+(2<<~t)}export{N as default};
